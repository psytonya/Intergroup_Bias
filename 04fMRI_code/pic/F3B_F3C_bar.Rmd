---
title: "F3B_F3C_BRAINbar"
author: "lzt"
date: "2025-06-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load package}
source("function_rainclouds.R")
source("function_summarySE.R")
library(ggplot2)
library(gghalves)
library(cowplot)
library(readr)
library(dplyr)
```

```{r load data}

membership_inter_split <- read.csv("./cloudrain_brain.csv")

# 添加因子化的membership和emo列
membership_inter_split$membership <-
  ifelse(membership_inter_split$membership == 1, "in-group", "out-group")
membership_inter_split$split <-
  ifelse(membership_inter_split$split == 1, "fair", "unfair")

# 将新添加的列转化为因子型
membership_inter_split$membership <-
  as.factor(membership_inter_split$membership)
membership_inter_split$split<-
  as.factor(membership_inter_split$split)
```


```{r F3C_dACC}
library(ggplot2)
library(dplyr)
# 若未加载Hmisc包，需先运行：library(Hmisc)

# 数据准备
sumrepdat <- summarySE(
  membership_inter_split,
  measurevar = "Interaction_dACC",
  groupvars = c("membership", "split")
)

# 设置自定义顺序 - 将unfair放在fair前面
custom_order <- c("unfair", "fair")  # 修改了顺序
membership_inter_split$split <- factor(membership_inter_split$split, levels = custom_order)
sumrepdat$split <- factor(sumrepdat$split, levels = custom_order)

# 设置绘图参数
w <- 7
h <- 6

# 创建颜色映射
color_palette <- c("in-group" = "#48C0AA", "out-group" = "#456990")

# 绘制图表（直接使用split作为x轴，分组展示membership）
Interaction_dACC_plot <- ggplot(membership_inter_split, aes(x = split, y = Interaction_dACC, fill = membership)) +
  # 绘制小提琴图（组内并列展示in/out-group）
  geom_violin(
    aes(color = membership),
    position = position_dodge(width = 0.8),  # 调整组内间距
    alpha = 0.3,
    width = 0.6,
    trim = FALSE,
    size = 0
  ) +
  
  # 叠加箱线图
  geom_boxplot(
    aes(color = membership),
    position = position_dodge(width = 0.8),  # 与小提琴图对齐
    width = 0.3,  # 箱线图宽度
    alpha = 0.5,  # 透明度
    outlier.shape = NA,  # 不显示离群点，避免与散点图冲突
    size = 0.8  # 边框线粗细
  ) +
  
  # 叠加散点图（抖动位置）
  geom_jitter(
    aes(color = membership),
    position = position_jitterdodge(
      jitter.width = 0.15,  # 水平抖动宽度
      dodge.width = 0.8     # 与小提琴图和箱线图对齐
    ),
    alpha = 0.7,  # 点的透明度
    size = 1,     # 点的大小
    shape = 16    # 使用实心圆

  ) +
  
  # 绘制均值点
  geom_point(
    data = sumrepdat,
    aes(x = split, y = Interaction_dACC_mean, group = membership, color = membership),
    position = position_dodge(width = 0.8),  # 与小提琴图对齐
    shape = 19,
    size = 2,
    stroke = 1,  # 点的边框粗细
    colour = "black" 
  ) +
  
  # 绘制误差线
  geom_errorbar(
    data = sumrepdat,
    aes(
      x = split, 
      y = Interaction_dACC_mean, 
      group = membership, 
      color = membership,
      ymin = Interaction_dACC_mean - sem,
      ymax = Interaction_dACC_mean + sem
    ),
    position = position_dodge(width = 0.8),
    width = 0.2,
    size = 0.5,
    colour = "black" 
  ) +
  
  # 坐标轴和标签设置
  labs(x = 'split', y = "Parameter estimates in dACC") +
  scale_y_continuous(
    expand = c(0, 0), 
    breaks = c(-15, 0, 15, 30,45), 
    limits = c(-15, 45)
  ) +
  scale_x_discrete(
    labels = c("unfair" = "Unfair", "fair" = "Fair"),  # 调整标签顺序
    name = NULL
  ) +
  
  # 自定义主题（移除所有边框，只保留x轴和y轴）
  theme(
    text = element_text(family = "serif"),
    axis.ticks = element_line(size = 0.4, color = "black"),
    panel.background = element_blank(),  # 移除面板背景
    plot.background = element_rect(fill = "transparent", color = NA),
    panel.grid = element_blank(),  # 移除网格线
    axis.title.y = element_text(colour = "black",size = 30, vjust = 0.5, face = "bold", family = "serif"),
    axis.text.x = element_text(colour = "black",size = 30, face = "bold", family = "serif", margin = margin(t = 8)),
    axis.text.y = element_text(size = 30,colour = "black", face = "bold", family = "serif"),
    axis.line.x = element_line(colour = "black", size = 0.8),  # 保留x轴线
    axis.line.y = element_line(colour = "black", size = 0.8),  # 保留y轴线
    legend.position = "none",#c(0.5, 1.0),
    legend.direction = "horizontal",
    legend.title = element_blank(),
    legend.text = element_text(size = 28, face = "bold", family = "serif"),
    legend.background = element_blank(),  # 移除图例背景
    legend.box.background = element_blank(),
    plot.margin = unit(c(2, 1, 1, 1), "cm")
  ) +
  
  # 颜色和形状设置
  scale_fill_manual(values = color_palette, labels = c("inG", "outG")) +
  scale_color_manual(values = color_palette, labels = c("inG", "outG"))

# 显示图表
print(Interaction_dACC_plot)

# 保存图表
ggsave('./violin_boxplot_scatter_Interaction_dACC.png', Interaction_dACC_plot, width = w, height = h, dpi = 300, bg = "transparent")
```


```{r F3B_mPFC}
library(ggplot2)
library(dplyr)
# 若未加载Hmisc包，需先运行：library(Hmisc)

# 数据准备
sumrepdat <- summarySE(
  membership_inter_split,
  measurevar = "Interaction_rmPFC",
  groupvars = c("membership", "split")
)

# 设置自定义顺序 - 将unfair放在fair前面
custom_order <- c("unfair", "fair")  # 修改了顺序
membership_inter_split$split <- factor(membership_inter_split$split, levels = custom_order)
sumrepdat$split <- factor(sumrepdat$split, levels = custom_order)

# 设置绘图参数
w <- 7
h <- 6

# 创建颜色映射
color_palette <- c("in-group" = "#48C0AA", "out-group" = "#456990")

# 绘制图表（直接使用split作为x轴，分组展示membership）
Interaction_rmPFC_plot <- ggplot(membership_inter_split, aes(x = split, y = Interaction_rmPFC, fill = membership)) +
  # 绘制小提琴图（组内并列展示in/out-group）
  geom_violin(
    aes(color = membership),
    position = position_dodge(width = 0.8),  # 调整组内间距
    alpha = 0.3,
    width = 0.6,
    trim = FALSE,
    size = 0
  ) +
  
  # 叠加箱线图
  geom_boxplot(
    aes(color = membership),
    position = position_dodge(width = 0.8),  # 与小提琴图对齐
    width = 0.3,  # 箱线图宽度
    alpha = 0.5,  # 透明度
    outlier.shape = NA,  # 不显示离群点，避免与散点图冲突
    size = 0.8  # 边框线粗细
  ) +
  
  # 叠加散点图（抖动位置）
  geom_jitter(
    aes(color = membership),
    position = position_jitterdodge(
      jitter.width = 0.15,  # 水平抖动宽度
      dodge.width = 0.8     # 与小提琴图和箱线图对齐
    ),
    alpha = 0.7,  # 点的透明度
    size = 1,     # 点的大小
    shape = 16    # 使用实心圆
    
  ) +
  
  # 绘制均值点
  geom_point(
    data = sumrepdat,
    aes(x = split, y = Interaction_rmPFC_mean, group = membership, color = membership),
    position = position_dodge(width = 0.8),  # 与小提琴图对齐
    shape = 19,
    size = 2,
    stroke = 1,  # 点的边框粗细
    colour = "black" 
  ) +
  
  # 绘制误差线
  geom_errorbar(
    data = sumrepdat,
    aes(
      x = split, 
      y = Interaction_rmPFC_mean, 
      group = membership, 
      color = membership,
      ymin = Interaction_rmPFC_mean - sem,
      ymax = Interaction_rmPFC_mean + sem
    ),
    position = position_dodge(width = 0.8),
    width = 0.2,
    size = 0.5,
    colour = "black" 
  ) +
  
  # 坐标轴和标签设置
  labs(x = 'split', y = "Parameter estimates in mPFC") +
  scale_y_continuous(
    expand = c(0, 0), 
    breaks = c(-24,-12, 0, 12,24), 
    limits = c(-24, 24)
  ) +
  scale_x_discrete(
    labels = c("unfair" = "Unfair", "fair" = "Fair"),  # 调整标签顺序
    name = NULL
  ) +
  
  # 自定义主题（移除所有边框，只保留x轴和y轴）
  theme(
    text = element_text(family = "serif"),
    axis.ticks = element_line(size = 0.4, color = "black"),
    panel.background = element_blank(),  # 移除面板背景
    plot.background = element_rect(fill = "transparent", color = NA),
    panel.grid = element_blank(),  # 移除网格线
    axis.title.y = element_text(colour = "black",size = 30, vjust = 0.5, face = "bold", family = "serif"),
    axis.text.x = element_text(colour = "black",size = 30, face = "bold", family = "serif", margin = margin(t = 8)),
    axis.text.y = element_text(size = 30,colour = "black", face = "bold", family = "serif"),
    axis.line.x = element_line(colour = "black", size = 0.8),  # 保留x轴线
    axis.line.y = element_line(colour = "black", size = 0.8),  # 保留y轴线
    legend.position = "none",#c(0.5, 1.0),
    legend.direction = "horizontal",
    legend.title = element_blank(),
    legend.text = element_text(size = 28, face = "bold", family = "serif"),
    legend.background = element_blank(),  # 移除图例背景
    legend.box.background = element_blank(),
    plot.margin = unit(c(2, 1, 1, 1), "cm")
  ) +
  
  # 颜色和形状设置
  scale_fill_manual(values = color_palette, labels = c("inG", "outG")) +
  scale_color_manual(values = color_palette, labels = c("inG", "outG"))

# 显示图表
print(Interaction_rmPFC_plot)

# 保存图表
ggsave('./violin_boxplot_scatter_Interaction_mPFC.png', Interaction_rmPFC_plot, width = w, height = h, dpi = 300, bg = "transparent")
```
